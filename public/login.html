<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Login | Sistema de Inventario INVECEM</title>
<style>
body {
    margin:0; padding:0; font-family:"Segoe UI", sans-serif;
    background: url("img/fondo.jpg") no-repeat center center/cover;
    height:100vh; display:flex; justify-content:center; align-items:center;
}
.login-box {
    background: rgba(255,255,255,0.15);
    backdrop-filter: blur(10px);
    padding:40px; border-radius:18px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.25);
    color:#fff; text-align:center; width:380px;
}
.login-box h2 { margin-bottom:25px; font-size:26px; font-weight:600; letter-spacing:1px; }
.input-group { text-align:left; margin-bottom:20px; }
.input-group label { display:block; font-size:14px; margin-bottom:5px; }
.input-group input {
    width:100%; padding:12px; border:none; border-radius:8px;
    outline:none; background: rgba(255,255,255,0.8); font-size:15px;
}
button {
    width:100%; padding:12px; border:none; border-radius:8px;
    background:#00aaff; color:#fff; font-size:16px; cursor:pointer;
}
button:hover { background:#0088cc; }
.footer-text { margin-top:20px; font-size:13px; opacity:0.85; }
.error-msg { color:#ff8080; margin-top:10px; font-size:14px; display:none; }
</style>
</head>
<body>

<div class="login-box">
    <h2>Inventario de Tecnología</h2>
    <form id="loginForm">
        <div class="input-group">
            <label>Usuario</label>
            <input type="text" id="usuario" required placeholder="Ingrese su usuario">
        </div>
        <div class="input-group">
            <label>Contraseña</label>
            <input type="password" id="password" required placeholder="Ingrese su contraseña">
        </div>
        <button type="submit" id="btnLogin">Iniciar Sesión</button>
        <p class="error-msg" id="errorMsg"></p>
        <p class="footer-text">© 2025 Planta INVECEM – Sistema de Control de Inventario</p>
    </form>
</div>

<script>
const loginForm = document.getElementById("loginForm");
const errorMsg = document.getElementById("errorMsg");
const btnLogin = document.getElementById("btnLogin");

loginForm.addEventListener("submit", async (e) => {
    e.preventDefault();
    errorMsg.style.display = "none";
    btnLogin.disabled = true;
    btnLogin.textContent = "Validando...";

    const usuario = document.getElementById("usuario").value.trim();
    const password = document.getElementById("password").value.trim();

    try {
        const resp = await fetch("/api/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ usuario, password })
        });

        const data = await resp.json();
        console.log("RESPUESTA LOGIN:", data);

        if (!data.ok) {
            errorMsg.textContent = data.mensaje;
            errorMsg.style.display = "block";
            btnLogin.disabled = false;
            btnLogin.textContent = "Iniciar Sesión";
            return;
        }

        // Guardar usuario y token
        localStorage.setItem("usuario", JSON.stringify(data.user));
        localStorage.setItem("token", data.token);

        // Redirección según rol
        const rol = data.user.rol.trim().toLowerCase();
        if (rol === "admin") window.location.href = "/admin.html";
        else if (rol === "coordinador") window.location.href = "/coordinador.html";
        else if (rol === "gerente_ti") window.location.href = "/gerente.html";

    } catch (err) {
        errorMsg.textContent = "No se pudo conectar al servidor";
        errorMsg.style.display = "block";
        btnLogin.disabled = false;
        btnLogin.textContent = "Iniciar Sesión";
    }
});

// Redirección automática si ya hay sesión
window.addEventListener("load", () => {
    const user = JSON.parse(localStorage.getItem("usuario"));
    const token = localStorage.getItem("token");
    if (user && token) {
        const rol = user.rol.trim().toLowerCase();
        if (rol === "admin") window.location.href = "/admin.html";
        else if (rol === "coordinador") window.location.href = "/coordinador.html";
        else if (rol === "gerente_ti") window.location.href = "/gerente.html";
    }
});
</script>

</body>
</html>


