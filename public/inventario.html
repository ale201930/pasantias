<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Inventario - Tecnologia</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
body { display:flex; height:100vh; background:#f0f2f5; }

/* SIDEBAR */
.sidebar { width:250px; background:#1b263b; color:#fff; display:flex; flex-direction:column; padding:20px 0; }
.logo { text-align:center; margin-bottom:30px; }
.logo h2 { font-size:24px; font-weight:bold; }
.menu { list-style:none; }
.menu li { padding:15px 20px; cursor:pointer; font-size:16px; border-left:4px solid transparent; transition:0.3s; }
.menu li:hover, .menu .active { background:#415a77; border-left:4px solid #e0e1dd; }
.logout { margin-top:auto; background:#a4161a !important; border-left:4px solid #fff !important; }

/* MAIN */
.main { flex:1; display:flex; flex-direction:column; overflow:hidden; }
.topbar { background:#e0e1dd; padding:20px; border-bottom:2px solid #ccc; }
.topbar h1 { font-size:22px; }
#contenido { padding:30px; overflow:auto; }

/* CARD */
.card { background:#fff; padding:25px; border-radius:12px; box-shadow:0 2px 10px #ccc; width:100%; max-width:none; margin:0 auto; }
.tabla-container { width:100%; overflow-x:auto; margin-top:20px; }

/* TABLA */
table { width:100%; border-collapse:collapse; min-width:1600px; }
table th, table td { border:1px solid #ddd; padding:10px 12px; text-align:left; white-space:nowrap; }
table th { background:#1b263b; color:white; position:sticky; top:0; z-index:1; }
tr:nth-child(even) { background-color:#f2f2f2; }
tr:hover { background-color:#e0e1dd; }

/* INPUTS */
input[type="text"], select { padding:8px; margin-right:10px; border-radius:5px; border:1px solid #aaa; font-size:14px; }

/* BOTONES */
.btn { padding:10px 15px; border:none; border-radius:5px; background:#1b263b; color:white; cursor:pointer; font-size:14px; margin-right:5px; }
.btn:hover { background:#415a77; }
.btn-eliminar { background:#a4161a; }
.btn-eliminar:hover { background:#d62828; }

/* TEXTO "NO APLICA" */
.na { color:#888; font-style:italic; }

/* RESPONSIVE */
@media(max-width:800px){
    .card { padding:20px; }
    table { font-size:12px; }
    input[type="text"], select { margin-bottom:10px; width:100%; }
}
</style>
</head>
<body>

<aside class="sidebar">
    <div class="logo"><h2>INVECEM</h2></div>
    <ul class="menu">
        <li onclick="window.location.href='dashboard.html'"> Estadisticas</li>
        <li onclick="window.location.href='registro.html'"> Registro</li>
        <li class="active" onclick="window.location.href='inventario.html'"> Inventario</li>
        <li onclick="window.location.href='usuarios.html'"> Usuarios</li>
        <li class="logout" onclick="cerrarSesion()"> Cerrar sesi贸n</li>
    </ul>
</aside>

<main class="main">
<header class="topbar">
    <h1 id="tituloModulo">Inventario</h1>
</header>

<section id="contenido">
<div class="card">
    <h2>Inventario de Equipos</h2>

    <div>
        <!-- NUEVO INPUT DE BSQUEDA -->
        <input type="text" id="filtroBusqueda" placeholder="Buscar por nombre, serial o usuario">

        <select id="filtroTipo">
            <option value="">Todos los tipos</option>
            <option value="PC">PC</option>
            <option value="Laptop">Laptop</option>
            <option value="Monitor">Monitor</option>
            <option value="Impresora">Impresora</option>
            <option value="Switch">Switch</option>
            <option value="Router">Router</option>
            <option value="Ap">AP</option>
            <option value="Radios">Radio</option>
            <option value="Escaner">Escaner</option>
            <option value="Starlink">Starlink</option>
            <option value="UPS">UPS</option>
        </select>

        <button class="btn" id="btnFiltrar">Filtrar</button>
        <button class="btn" id="btnInventarioGeneral">Inventario general</button>
    </div>

   <div class="tabla-container">
    <table id="tablaInventario">
        <thead>
            <tr>
                <th>ID</th>
                <th>Localidad</th>
                <th>Tipo</th>
                <th>Marca</th>
                <th>Modelo</th>
                <th>Serial</th>
                <th>Procesador</th>
                <th>RAM</th>
                <th>Disco</th>
                <th>Windows</th>
                <th>Antivirus</th>
                <th>Nombre del equipo</th>
                <th>IP</th>
                <th>BIOS</th>
                <th>Fecha asignaci贸n</th>
                <th>Usuario Responsable</th>
                <th>Ubicaci贸n</th>
                <th>Status</th>
                <th>Acciones</th>
            </tr>
        </thead>

        <tbody>
            <!-- JS llena las filas aqu铆 -->
        </tbody>
    </table>
  </div>
</div>
</section>
</main>

<script>
// Mostrar "No aplica" si el valor est谩 vac铆o
function mostrar(valor) { return valor ? valor : '<span class="na">No aplica</span>'; }

// Cargar inventarios con filtros
async function cargarInventarios() {
    const filtroBusqueda = document.getElementById('filtroBusqueda').value.trim();
    const filtroTipo = document.getElementById('filtroTipo').value;

    const params = new URLSearchParams();
    if (filtroBusqueda) params.append('buscar', filtroBusqueda);
    if (filtroTipo) params.append('tipo_articulo', filtroTipo);

    const res = await fetch(`/api/inventario?${params.toString()}`);
    const data = await res.json();

    if (!data.ok) { console.error("Error backend:", data.error); return; }

    const tbody = document.querySelector('#tablaInventario tbody');
    tbody.innerHTML = '';

    data.equipos.forEach(e => {
        tbody.innerHTML += `
            <tr>
                <td>${e.id}</td>
                <td>${mostrar(e.localidad)}</td>
                <td>${mostrar(e.tipo_articulo)}</td>
                <td>${mostrar(e.marca)}</td>
                <td>${mostrar(e.modelo)}</td>
                <td>${mostrar(e.serial)}</td>
                <td>${mostrar(e.procesador)}</td>
                <td>${mostrar(e.ram)}</td>
                <td>${mostrar(e.disco)}</td>
                <td>${mostrar(e.version_windows)}</td>
                <td>${mostrar(e.antivirus)}</td>
                <td>${mostrar(e.nombre_del_equipo)}</td>
                <td>${mostrar(e.ip)}</td>
                <td>${mostrar(e.bios)}</td>
                <td>${mostrar(e.fecha_de_asignacion)}</td>
                <td>${mostrar(e.usuario_responsable)}</td>
                <td>${mostrar(e.ubicacion)}</td>
                <td>${mostrar(e.status)}</td>
                <td>
                    <button class="btn" onclick="editarEquipo(${e.id})">Editar</button>
                    <button class="btn btn-eliminar" onclick="eliminarEquipo(${e.id})">Eliminar</button>
                </td>
            </tr>
        `;
    });
}

// Bot贸n Inventario general
document.getElementById('btnInventarioGeneral').addEventListener('click', () => {
    document.getElementById('filtroBusqueda').value = '';
    document.getElementById('filtroTipo').value = '';
    cargarInventarios();
});

// Bot贸n Filtrar
document.getElementById('btnFiltrar').addEventListener('click', cargarInventarios);

// ELIMINAR EQUIPO
async function eliminarEquipo(id) {
    if (!confirm('驴Seguro que quieres eliminar este equipo?')) return;
    try {
        const res = await fetch(`/api/inventario/${id}`, { method: 'DELETE' });
        const data = await res.json();
        if (data.ok) { alert('Equipo eliminado correctamente'); cargarInventarios(); }
        else alert('Error al eliminar: ' + data.error);
    } catch (err) { console.error(err); alert('Error al conectar con el servidor'); }
}

// EDITAR EQUIPO
async function editarEquipo(id) {
    try {
        const res = await fetch(`/api/inventario/${id}`);
        const data = await res.json();
        if (!data.ok) { alert('Error al obtener equipo: ' + data.error); return; }
        window.location.href = `registro.html?id=${id}`;
    } catch (err) { console.error(err); alert('Error al conectar con el servidor'); }
}

// Cargar inventario al iniciar
cargarInventarios();
</script>

</body>
</html>

