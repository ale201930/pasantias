<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Registro de Equipos - INVECEM</title>
<style>
/* ===== RESET Y ESTILOS BASE ===== */
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
body { display: flex; height: 100vh; background: #f0f2f5; }

/* ===== SIDEBAR ===== */
.sidebar { width: 250px; background: #1b263b; color: #fff; display: flex; flex-direction: column; padding: 20px 0; }
.logo { text-align: center; margin-bottom: 30px; }
.logo h2 { font-size: 24px; font-weight: bold; }
.menu { list-style: none; }
.menu li { padding: 15px 20px; cursor: pointer; font-size: 16px; border-left: 4px solid transparent; transition: 0.3s; }
.menu li:hover, .menu .active { background: #415a77; border-left: 4px solid #e0e1dd; }
.logout { margin-top: auto; background: #a4161a !important; border-left: 4px solid #fff !important; }

/* ===== CONTENIDO PRINCIPAL ===== */
.main { flex: 1; display: flex; flex-direction: column; overflow-y: auto; }
.topbar { background: #e0e1dd; padding: 20px; border-bottom: 2px solid #ccc; }
.topbar h1 { font-size: 22px; }
#contenido { padding: 30px; }
.card { background: #fff; padding: 25px; border-radius: 12px; box-shadow: 0 2px 10px #ccc; max-width: 700px; margin: 0 auto; }
.card h2 { margin-bottom: 20px; color: #1b263b; text-align: center; }

form label { display: block; margin-top: 15px; font-weight: bold; color: #1b263b; }
form input, form select { width: 100%; padding: 10px; margin-top: 5px; border: 1px solid #aaa; border-radius: 8px; font-size: 15px; }
form input:focus, form select:focus { outline: none; border-color: #415a77; }

.btn { margin-top: 20px; padding: 12px; width: 100%; background: #1b263b; color: white; border: none; font-size: 16px; border-radius: 8px; cursor: pointer; }
.btn:hover { background: #415a77; }

#msgRegistro { margin-top: 15px; font-weight: bold; text-align: center; }
#camposExtra label { margin-top: 10px; }
#camposExtra input { margin-bottom: 5px; }

@media(max-width: 600px) {
    .card { padding: 20px; }
    .sidebar { width: 200px; }
}
</style>
</head>
<body>

<!-- ===== SIDEBAR ===== -->
<aside class="sidebar">
    <div class="logo"><h2>INVECEM</h2></div>
    <ul class="menu">
        <li onclick="window.location.href='dashboard.html'"> Estadisticas</li>
        <li class="active" onclick="window.location.href='registro.html'"> Registro</li>
        <li onclick="window.location.href='inventario.html'"> Inventario</li>
        <li onclick="window.location.href='usuarios.html'"> Usuarios</li>
        <li class="logout" onclick="cerrarSesion()"> Cerrar sesi贸n</li>
    </ul>
</aside>

<!-- ===== CONTENIDO PRINCIPAL ===== -->
<main class="main">
    <header class="topbar">
        <h1 id="tituloModulo">Registro de Equipos</h1>
    </header>

    <section id="contenido">
        <div class="card">
            <h2 id="tituloFormulario">Formulario de Registro</h2>

            <form id="formRegistro">
                <label>Localidad:</label>
                <select name="localidad" required>
                    <option value="">Seleccione</option>
                    <option>Senderos/Distrito Capital</option>
                    <option>Planta Cumarebo</option>
                    <option>Planta San Sebastian</option>
                    <option>Planta Magdaleno</option>
                    <option>Planta Maracay</option>
                    <option>Planta Tachira</option>
                </select>

                <label>Tipo de art铆culo:</label>
                <select name="tipo_articulo" id="tipoArticulo" required onchange="mostrarCampos()">
                    <option value="">Seleccione</option>
                    <option value="PC">Computador de Escritorio</option>
                    <option value="Laptop">Laptop</option>
                    <option value="Monitor">Monitor</option>
                    <option value="Impresora">Impresora</option>
                    <option value="Switch">Switch</option>
                    <option value="Router">Router</option>
                    <option value="Ap">Ap</option>
                    <option value="Radios">Radio</option>
                    <option value="Escaner">Escaner</option>
                    <option value="Starlink">Starlink</option>
                    <option value="UPS">UPS</option>
                </select>

                <div id="camposExtra"></div>

                <button type="submit" class="btn" id="btnGuardar">Guardar Art铆culo</button>
            </form>

            <p id="msgRegistro"></p>
        </div>
    </section>
</main>

<script>
/* ===== DETECTAR MODO EDICIN ===== */
const params = new URLSearchParams(window.location.search);
const idEquipo = params.get("id");

const tituloModulo = document.getElementById("tituloModulo");
const tituloFormulario = document.getElementById("tituloFormulario");
const btnGuardar = document.getElementById("btnGuardar");
const form = document.getElementById("formRegistro");

if (idEquipo) {
    tituloModulo.textContent = "Editar Equipo";
    tituloFormulario.textContent = "Editar Equipo";
    btnGuardar.textContent = "Actualizar Art铆culo";
    cargarEquipo(idEquipo);
}

/* ===== MOSTRAR CAMPOS ===== */
function mostrarCampos() {
    const tipo = document.getElementById("tipoArticulo").value;
    const container = document.getElementById("camposExtra");
    container.innerHTML = "";

    let camposHTML = "";

    const camposPC = `
<label>Marca:</label><input type="text" name="marca">
<label>Modelo:</label><input type="text" name="modelo">
<label>Serial:</label><input type="text" name="serial">
<label>Procesador:</label><input type="text" name="procesador">
<label>RAM:</label><input type="text" name="ram">
<label>Disco duro:</label><input type="text" name="disco">
<label>Versi贸n Windows:</label><input type="text" name="version_windows">
<label>Antivirus:</label><input type="text" name="antivirus">
<label>Nombre del Equipo:</label><input type="text" name="nombre_del_equipo">
<label>Ubicaci贸n:</label><input type="text" name="ubicacion">
<label>Usuario Responsable:</label><input type="text" name="usuario_responsable">
<label>IP:</label><input type="text" name="ip">
<label>BIOS:</label><input type="text" name="bios">
<label>Fecha de Asignaci贸n:</label><input type="date" name="fecha_de_asignacion">
<label>Status:</label>
<select name="status">
<option value="Activo">Activo</option>
<option value="Inactivo">Inactivo</option>
</select>
`;

    const camposGenerales = `
<label>Marca:</label><input type="text" name="marca">
<label>Modelo:</label><input type="text" name="modelo">
<label>Serial:</label><input type="text" name="serial">
<label>Ubicaci贸n:</label><input type="text" name="ubicacion">
<label>Usuario Responsable:</label><input type="text" name="usuario_responsable">
<label>Fecha de Asignaci贸n:</label><input type="date" name="fecha_de_asignacion">
<label>Status:</label>
<select name="status">
<option value="Activo">Activo</option>
<option value="Inactivo">Inactivo</option>
</select>
`;

    const camposRedes = `
<label>Marca:</label><input type="text" name="marca">
<label>Modelo:</label><input type="text" name="modelo">
<label>Serial:</label><input type="text" name="serial">
<label>Ubicaci贸n:</label><input type="text" name="ubicacion">
<label>Fecha de Asignaci贸n:</label><input type="date" name="fecha_de_asignacion">
<label>IP:</label><input type="text" name="ip">
<label>MAC:</label><input type="text" name="mac">
<label>Status:</label>
<select name="status">
<option value="Activo">Activo</option>
<option value="Inactivo">Inactivo</option>
</select>
`;

    if (tipo === "PC" || tipo === "Laptop") camposHTML = camposPC;
    else if (["Monitor","Impresora","Switch","Escaner","Starlink","UPS"].includes(tipo)) camposHTML = camposGenerales;
    else camposHTML = camposRedes;

    container.innerHTML = camposHTML;
}

/* ===== CARGAR EQUIPO ===== */
async function cargarEquipo(id) {
    const res = await fetch(`/api/inventario/${id}`);
    const data = await res.json();

    const equipo = data.equipo;

    form.localidad.value = equipo.localidad;
    form.tipo_articulo.value = equipo.tipo_articulo;

    mostrarCampos();

    for (const key in equipo) {
        const campo = form.querySelector(`[name="${key}"]`);
        if (campo) campo.value = equipo[key];
    }
}

/* ===== ENVIAR FORMULARIO ===== */
document.addEventListener("submit", async (e) => {
    if (e.target.id !== "formRegistro") return;
    e.preventDefault();

    const datos = Object.fromEntries(new FormData(form));

    const url = idEquipo
        ? `/api/inventario/${idEquipo}`
        : "/api/inventario/registrar";

    const method = idEquipo ? "PUT" : "POST";

    try {
        const res = await fetch(url, {
            method,
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(datos)
        });

        const result = await res.json();
        const msg = document.getElementById("msgRegistro");

        if (result.ok) {
            msg.style.color = "green";
            msg.textContent = "Guardado correctamente 锔";

            // Redirigir autom谩ticamente a inventario.html
            setTimeout(() => {
                window.location.href = "inventario.html";
            }, 1000);
        } else {
            msg.style.color = "red";
            msg.textContent = result.error;
        }
    } catch (err) {
        console.error(err);
        const msg = document.getElementById("msgRegistro");
        msg.style.color = "red";
        msg.textContent = "Error al conectar con el servidor";
    }
});
</script>

</body>
</html>
